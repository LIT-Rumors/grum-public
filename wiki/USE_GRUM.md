# Use the generated GRuM Platform

We provide a brief overview how to run the monitoring plaform based on the [PiCar example](/wiki/MODEL_NEW_SYSTEM.md)

## Resource Overview: 
The ``%project_name%`` is defined in the WM.

__Generated Resources:__

- ``%project_name%.twin``
Contains the main features of the generated Monitoring Platform, the runtime model, connectors, etc.

To run the Platform execute the class ``DigitalTwinRunner``

(MQTT connections, topic subscriptions, etc. are all generated automatically)
![image](https://user-images.githubusercontent.com/24531486/174434358-7d346819-ebbb-48b2-97e4-790b822ffbde.png)


- ``%project_name%.middleware``

Contains the generated code for forwarding received monitoring data, constraint violations, etc.

- ``%project_name%.service.middleware``

Maven project version of the middleware (so that it can be easily used bu external applications) 

- ``%project_name%.query``

Viatra Query plugin. An initial viatra VQL file is automatically geneated that can be directly populated with constraints

For the Java Probes GRuM additionally generates
- ``%project_name%.api``

The API maven project. The class ``MonitoringAPI`` contains a callable methods for each Monitorable Property defined in the ADM.

For the Python Probes GRuM additionally generates
- ``%project_name%.ros.api``
Contains the Python code for the ROS module



For the PiCar Project the following 5 projects are generated with GRuM

![image](https://user-images.githubusercontent.com/24531486/172625230-2af2dab8-e0e6-422c-906e-12711dc7739b.png)


## Writing Constraints: 

We use [Viatra](https://www.eclipse.org/viatra/) that directly operates on the instantiated ecore runtime model. 

Constraints are defined using the [Viatra Query Language](https://www.eclipse.org/viatra/documentation/query-language.html)

Once defined in the [VQL File](/usecases/examples/monitoredsystems/generated/picar/PicarProject.query/src/query/PicarSystemQueries.vql), the respective code is automatically generated by Viatra,

In order to execute the checks, they need to be registered with the query engine.
GRuM generates a [template class (``%project_name%ViatraQueryExecutor``)](/usecases/examples/monitoredsystems/generated/picar/PicarProject.query/src/query/PicarSystemViatraQueryExecutor.java) for this, where new Viatra checks can be easily added

Additionally, for both the Dronology and TurtleBot system, we are using Complex Event Processing with [Esper](https://www.espertech.com/esper) for additional (temporal) constraints.

The [project](/examples/misc/at.jku.lit.grum.extensions.esper) can be easily extended an new CEP Rules can be added for checking additional properties.



## Run Platform: 

1. To run the Platform execute the class ``DigitalTwinRunner`` in the `%project_name%.twin`` project
2. For testing purposes, we have created a simple Python [script](/usecases/examples/misc/PiCarMonitoringTester.py) for the PiCar example that generates and sends "Dummy Monitoring Data" and also triggers random violations in the sample Viatra Constraits.
